rules_version = '2';

service cloud.firestore {

  match /databases/{database}/documents {

    // Helper functions

    function isAuthenticated() {

      return request.auth != null;

    }

    

    // For now, allow all authenticated users (client-side enforces admin check)

    function isAdmin() {

      return isAuthenticated();

    }

    

    // GLOBAL CHAMPION DATA

    match /champions/global {

      allow read: if isAuthenticated();

      allow write: if isAdmin();

    }

    

    // GLOBAL SETTINGS

    match /settings/global {

      allow read: if isAuthenticated();

      allow write: if isAdmin();

    }

    

    // WORKSPACES

    match /workspaces/{workspaceId} {

      match /metadata/info {

        allow read: if isAuthenticated();

        allow create, update, delete: if isAdmin();

      }

      match /users/{userId} {

        allow read: if isAuthenticated();

        allow create: if isAdmin() || request.auth.uid == userId;

        allow update: if isAuthenticated();

        allow delete: if isAdmin();

      }

      match /drafts/{document=**} {

        allow read, write: if isAuthenticated();

      }

      match /savedDrafts/{draftId} {

        allow read, write: if isAuthenticated();

      }
      
      // Scouting data
      match /scouting/players/{playerId} {
        // Workspace members can read player list
        allow read: if isAuthenticated();
        // Only admins can add/update/delete players
        allow write: if isAdmin();
      }
      
      match /scouting/data/{playerId} {
        // Workspace members can read scouting data
        allow read: if isAuthenticated();
        // Only admins can write scouting data
        allow write: if isAdmin();
      }
    }
  }
}
