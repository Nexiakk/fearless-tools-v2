rules_version = '2';

service cloud.firestore {

  match /databases/{database}/documents {

    // Helper functions

    function isAuthenticated() {

      return request.auth != null;

    }

    

    // For now, allow all authenticated users (client-side enforces admin check)

    function isAdmin() {

      return isAuthenticated();

    }


    // INDIVIDUAL CHAMPION DOCUMENTS

    match /champions/data/champions/{championId} {

      allow read: if isAuthenticated();

      allow write: if isAdmin();

    }

    // CHAMPION DATA DOCUMENT

    match /champions/data {

      allow read: if isAuthenticated();

      allow write: if isAdmin();

    }

    

    // GLOBAL SETTINGS

    match /settings/global {

      allow read: if isAuthenticated();

      allow write: if isAdmin();

    }

    // GLOBAL DEFAULT TIERS

    match /tiers/default {

      allow read: if isAuthenticated();

      allow write: if isAdmin();

    }

    // WORKSPACES

    match /workspaces/{workspaceId} {

      match /metadata/info {

        allow read: if isAuthenticated();

        allow create, update, delete: if isAdmin();

      }

      match /users/{userId} {

        allow read: if isAuthenticated();

        allow create: if isAdmin() || request.auth.uid == userId;

        allow update: if isAuthenticated();

        allow delete: if isAdmin();

      }

      match /drafts/{document=**} {

        allow read, write: if isAuthenticated();

      }

      match /savedDrafts/{draftId} {

        allow read, write: if isAuthenticated();

      }

      // TIERS - workspace-specific tier management
      match /tiers/{document=**} {

        allow read, write: if isAuthenticated();

      }
      
      // LCU Draft data (from external LCU client)
      match /lcuDrafts/{lobbyId} {
        // Workspace members can read LCU draft data
        allow read: if isAuthenticated();
        // Create/update are handled server-side via Netlify function (bypasses rules)
        allow create, update: if false; // Explicitly deny client-side create/update
        // Allow authenticated users to delete (for "Reset Unavailable" functionality)
        allow delete: if isAuthenticated();
      }
      
      // Scouting data - direct collections under workspace (like drafts)
      match /scoutingPlayers/{playerId} {
        // Workspace members can read player list
        allow read: if isAuthenticated();
        // Only admins can add/update/delete players
        allow write: if isAdmin();
      }
      
      match /scoutingData/{playerId} {
        // Workspace members can read scouting data
        allow read: if isAuthenticated();
        // Only admins can write scouting data
        allow write: if isAdmin();
      }
      
      match /scoutingSettings/{document=**} {
        // Workspace members can read scouting settings (team names)
        allow read: if isAuthenticated();
        // Only admins can write scouting settings
        allow write: if isAdmin();
      }
      
      match /scoutingTeams/{teamId} {
        // Workspace members can read teams
        allow read: if isAuthenticated();
        // Only admins can write teams
        allow write: if isAdmin();
      }
      
      // SERIES COLLECTION
      match /series/{seriesId} {
        // Workspace members can read series
        allow read: if isAuthenticated();
        // Workspace members can create/update/delete series
        allow write: if isAuthenticated();
        
        // NOTES subcollection under series
        match /notes/{noteId} {
          // Workspace members can read notes
          allow read: if isAuthenticated();
          // Workspace members can create/update/delete notes
          allow write: if isAuthenticated();
        }
      }
      
      
    }
  }
}
